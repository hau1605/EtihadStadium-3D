<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
	<title>Smartcity - Building Map</title>

	<style>
		* {
			padding: 0;
			margin: 0;
		}

		html,
		body,
		#viewDiv {
			height: 100%;
			width: 100%;
		}
	</style>

	<link rel="stylesheet" href="https://js.arcgis.com/4.28/esri/themes/light/main.css">
	<script src="https://js.arcgis.com/4.28/"></script>
	<script>
		var list_points = [];
		var string_points = "";
		function copyTextToClipboard(text) {
			if (!navigator.clipboard) {
				fallbackCopyTextToClipboard(text);
				return;
			}
			navigator.clipboard.writeText(text).then(function () {
				console.log('Async: Copying to clipboard was successful!');
			}, function (err) {
				console.error('Async: Could not copy text: ', err);
			});
		}
		require([
			"esri/Map",
			"esri/Graphic",
			"esri/views/SceneView",
			"esri/geometry/Mesh",
			"esri/geometry/Point",
			"esri/layers/GeoJSONLayer",
			"esri/layers/SceneLayer", 
			"esri/layers/GraphicsLayer",
			"esri/layers/FeatureLayer", 
			"esri/Graphic", 
			"esri/request",
			"esri/symbols/ObjectSymbol3DLayer"
		], function (Map, Graphic, SceneView, Mesh, Point, GeoJSONLayer, SceneLayer,
			GraphicsLayer, FeatureLayer, Graphic, esriRequest, ObjectSymbol3DLayer) {
			var createGraphic = function (data) {
				return new Graphic({
					geometry: data,
					symbol: data.symbol,
					attributes: data,
					popupTemplate: data.popupTemplate
				});
			};
			// geojson layer
			const geojsonLayer = new GeoJSONLayer({
				url: "./data/spiral_stair/column.geojson",
				renderer: {
					type: "simple",
					symbol: {
						type: "polygon-3d",
						symbolLayers: [
							{
								type: "extrude",
								size: 100.00000,
								material: {
									color: "green"
								}
							}
						]
					}
				}
			});
			// Zone A
			const geojsonLayer_A_roof = new GeoJSONLayer({
				url: "./data/zone_a/zone_a_roof.geojson",
				renderer: {
					type: "simple",
					symbol: {
						type: "polygon-3d",
						symbolLayers: [
							{
								type: "extrude",
								size: 100.00000,
								material: {
									color: "blue"
								}
							}
						]
					}
				}
			});
			const geojsonLayer_A_wall = new GeoJSONLayer({
				url: "./data/zone_a/zone_a_wall.geojson",
				renderer: {
					type: "simple",
					symbol: {
						type: "polygon-3d",
						symbolLayers: [
							{
								type: "extrude",
								size: 100.00000,
								material: {
									color: "blue"
								}
							}
						]
					}
				}
			});
			// Zone B
			const geojsonLayer_B_roof = new GeoJSONLayer({
				url: "./data/zone_b/zone_b_roof.geojson",
				renderer: {
					type: "simple",
					symbol: {
						type: "polygon-3d",
						symbolLayers: [
							{
								type: "extrude",
								size: 100.00000,
								material: {
									color: "blue"
								}
							}
						]
					}
				}
			});
			const geojsonLayer_B_wall = new GeoJSONLayer({
				url: "./data/zone_b/zone_b_wall.geojson",
				renderer: {
					type: "simple",
					symbol: {
						type: "polygon-3d",
						symbolLayers: [
							{
								type: "extrude",
								size: 100.00000,
								material: {
									color: "blue"
								}
							}
						]
					}
				}
			});
			// Zone C
			const geojsonLayer_C_top = new GeoJSONLayer({
				url: "./data/zone_c/zone_c_top.geojson",
				renderer: {
					type: "simple",
					symbol: {
						type: "polygon-3d",
						symbolLayers: [
							{
								type: "extrude",
								size: 0.4,
								material: {
									color: "white"
								}
							}
						]
					}
				}
			});
			const geojsonLayer_C_wall = new GeoJSONLayer({
				url: "./data/zone_c/zone_c_wall.geojson",
				renderer: {
					type: "simple",
					symbol: {
						type: "polygon-3d",
						symbolLayers: [
							{
								type: "extrude",
								size: 101.00000,
								material: {
									color: "#f0f0f0"
								}
							}
						]
					}
				}
			});
			const geojsonLayer_C_gate = new GeoJSONLayer({
				url: "./data/zone_c/zone_c_gate.geojson",
				renderer: {
					type: "simple",
					symbol: {
						type: "polygon-3d",
						symbolLayers: [
							{
								type: "extrude",
								size: 80.00000,
								material: {
									color: "blue"
								}
							}
						]
					}
				}
			});
			const geojsonLayer_C_curve = new GeoJSONLayer({
				url: "./data/zone_c/zone_c_curve.geojson",
				renderer: {
					type: "simple",
					symbol: {
						type: "polygon-3d",
						symbolLayers: [
							{
								type: "extrude",
								size: 1.50000,
								material: {
									color: "#c4c4c4"
								}
							}
						]
					}
				}
			});
			const geojsonLayer_C_roof_a = new GeoJSONLayer({
				url: "./data/zone_c/zone_c_roof_a.geojson",
				renderer: {
					type: "simple",
					symbol: {
						type: "polygon-3d",
						symbolLayers: [
							{
								type: "extrude",
								size: 0.2,
								material: {
									color: "#c4c4c4"
								}
							}
						]
					}
				}
			});
			const geojsonLayer_C_roof_b = new GeoJSONLayer({
				url: "./data/zone_c/zone_c_roof_b.geojson",
				renderer: {
					type: "simple",
					symbol: {
						type: "polygon-3d",
						symbolLayers: [
							{
								type: "extrude",
								size: 0.2,
								material: {
									color: "blue"
								}
							}
						]
					}
				}
			});
			// Zone D
			const geojsonLayer_D_roof = new GeoJSONLayer({
				url: "./data/zone_d/zone_d_roof.geojson",
				renderer: {
					type: "simple",
					symbol: {
						type: "polygon-3d",
						symbolLayers: [
							{
								type: "extrude",
								size: 100.00000,
								material: {
									color: "blue"
								}
							}
						]
					}
				}
			});
			const geojsonLayer_D_wall = new GeoJSONLayer({
				url: "./data/zone_d/zone_d_wall.geojson",
				renderer: {
					type: "simple",
					symbol: {
						type: "polygon-3d",
						symbolLayers: [
							{
								type: "extrude",
								size: 100.00000,
								material: {
									color: "blue"
								}
							}
						]
					}
				}
			});
			// Zone E
			const geojsonLayer_E_roof = new GeoJSONLayer({
				url: "./data/zone_e/zone_e_roof.geojson",
				renderer: {
					type: "simple",
					symbol: {
						type: "polygon-3d",
						symbolLayers: [
							{
								type: "extrude",
								size: 100.00000,
								material: {
									color: "blue"
								}
							}
						]
					}
				}
			});
			const geojsonLayer_E_wall = new GeoJSONLayer({
				url: "./data/zone_e/zone_e_wall.geojson",
				renderer: {
					type: "simple",
					symbol: {
						type: "polygon-3d",
						symbolLayers: [
							{
								type: "extrude",
								size: 100.00000,
								material: {
									color: "blue"
								}
							}
						]
					}
				}
			});
			// Spiral Stairs

			// Round Columns for Spiral Stairs
			const roundColumnLayerSpiral = new GraphicsLayer();
			const roundColumn_point_spiral = [
				[-2.199214597876507, 53.4838823487394, 50],
				[-2.1988804312003003, 53.483538189491995, 50],
				[-2.1987563679243802, 53.48310495815264, 50],
				[-2.1988623580722795, 53.48271284521822, 50],
				[-2.201882944520377, 53.48360738298203, 50],
				[-2.201993023811123, 53.48321004165876, 50],
				[-2.2018713186867824, 53.48277344024631, 50],
				[-2.201540077013828, 53.48243117205023, 50]
			]
			const roundColumn_symbol_spiral = {
				type: "point-3d",
				symbolLayers: [
					{
						type: "object",
						width: 7,
						height: 100,
						resource: { 
							primitive: "cylinder" 
						},
						material: { 
							color: "red" 
						}
					}
				]
			}
			for (const point of roundColumn_point_spiral) {
				const [x, y, z] = point;
				const pointLocation = new Point({
					x: x,
					y: y,
					z: z
				});
				const roundColumn_pointGraphic = new Graphic({
					geometry: pointLocation,
					symbol: roundColumn_symbol_spiral
				});
				roundColumnLayerSpiral.add(roundColumn_pointGraphic);
			}

			const map = new Map({
				basemap: "topo-vector",
				ground: "world-elevation",
				layers: [
					// geojsonLayer,
					geojsonLayer_A_roof,
					geojsonLayer_A_wall,
					geojsonLayer_B_roof,
					geojsonLayer_B_wall,
					geojsonLayer_C_top,
					geojsonLayer_C_wall,
					geojsonLayer_C_curve,
					geojsonLayer_C_roof_a,
					geojsonLayer_C_roof_b,
					geojsonLayer_C_gate,
					geojsonLayer_D_roof,
					geojsonLayer_D_wall,
					geojsonLayer_E_roof,
					geojsonLayer_E_wall
				]
			});
			map.add(roundColumnLayerSpiral);

			const view = new SceneView({
				container: "viewDiv",
				map: map,
				camera: {
					position: [-2.1957615021032595, 53.4836002000014, 300],
					heading: 260,
					tilt: 50
				}
			});
			view.popup.defaultPopupTemplateEnabled = true;
			// view.popup.autoOpenEnabled = false;
			view.on("click", function (event) { // Listen for the click event
				view.hitTest(event).then(function (hitTestResults) {
					if (hitTestResults.results) {
						list_points.push([event.mapPoint.longitude, event.mapPoint.latitude]);
						string_points += "[" + event.mapPoint.longitude + ", " + event.mapPoint.latitude + "],"
						copyTextToClipboard(string_points);
					}
				})
			});
			/* ============================================================ */

			/* ============================================================ */
			// const location_1 = new Point({
			// 	x: -2.199214597876507,
			// 	y: 53.4838823487394,
			// 	z: 50
			// });
			// Mesh.createFromGLTF(location_1, "./model/Part1.gltf")
			// 	.then(function (geometry) {
			// 		geometry.scale(1000, { 
			// 			origin: {
			// 				location_1
			// 			}
			// 		});
			// 		geometry.rotate(0, 0, 90);
			// 		const graphic = new Graphic({
			// 			geometry,
			// 			symbol: {
			// 				type: "mesh-3d",
			// 				symbolLayers: [
			// 					{
			// 						type: "fill",
			// 						material: {
			// 							// color: "rgba(0, 0, 255, 0.5)"
			// 						},
			// 						size: 1000
			// 					}
			// 				]
			// 			}
			// 		});
			// 		view.graphics.add(graphic);
			// 	})
			// 	.catch(console.error);
		});
		/* ============================================================ */
	</script>
</head>

<body>
	<div id="viewDiv"></div>
</body>

</html>