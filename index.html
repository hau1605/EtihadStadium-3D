<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="initial-scale=1,maximum-scale=1,user-scalable=no"
    />
    <title>Smartcity - Building Map</title>

    <style>
      * {
        padding: 0;
        margin: 0;
      }

      html,
      body,
      #viewDiv {
        height: 100%;
        width: 100%;
      }
    </style>

    <link
      rel="stylesheet"
      href="https://js.arcgis.com/4.28/esri/themes/light/main.css"
    />
    <script src="https://js.arcgis.com/4.28/"></script>
    <script>
      var list_points = [];
      var string_points = "";
      function copyTextToClipboard(text) {
        if (!navigator.clipboard) {
          fallbackCopyTextToClipboard(text);
          return;
        }
        navigator.clipboard.writeText(text).then(
          function () {
            console.log("Async: Copying to clipboard was successful!");
          },
          function (err) {
            console.error("Async: Could not copy text: ", err);
          }
        );
      }
      require([
        "esri/Map",
        "esri/Graphic",
        "esri/views/SceneView",
        "esri/geometry/Mesh",
        "esri/geometry/Point",
        "esri/layers/GeoJSONLayer",
        "esri/layers/SceneLayer",
        "esri/layers/GraphicsLayer",
        "esri/Graphic",
        "esri/request",
        "esri/symbols/ObjectSymbol3DLayer",
        "esri/geometry/Circle",
      ], function (
        Map,
        Graphic,
        SceneView,
        Mesh,
        Point,
        GeoJSONLayer,
        SceneLayer,
        GraphicsLayer,
        Graphic,
        esriRequest,
        ObjectSymbol3DLayer,
        Circle
      ) {
        var createGraphic = function (data) {
          return new Graphic({
            geometry: data,
            symbol: data.symbol,
            attributes: data,
            popupTemplate: data.popupTemplate,
          });
        };
        // spiral_stair
        const spiral_stair_floor = new GeoJSONLayer({
          url: "./data/spiral_stair/spiral_stair_floor.geojson",
          renderer: {
            type: "simple",
            symbol: {
              type: "polygon-3d",
              symbolLayers: [
                {
                  type: "extrude",
                  size: 0.01,
                  material: {
                    color: "green"
                  }
                }
              ]
            }
          }
        });
        const spiral_stair_handles = new GeoJSONLayer({
          url: "./data/spiral_stair/spiral_stair_handles.geojson",
          renderer: {
            type: "simple",
            symbol: {
              type: "polygon-3d",
              symbolLayers: [
                {
                  type: "fill",
                  size: 1,
                  material: {
                    color: "black"
                  }
                }
              ]
            }
          }
        });
        // Zone A
        const geojsonLayer_A_roof = new GeoJSONLayer({
          url: "./data/zone_a/zone_a_roof.geojson",
          renderer: {
            type: "simple",
            symbol: {
              type: "polygon-3d",
              symbolLayers: [
                {
                  type: "extrude",
                  size: 100.0,
                  material: {
                    color: "blue",
                  },
                },
              ],
            },
          },
        });
        const geojsonLayer_A_wall = new GeoJSONLayer({
          url: "./data/zone_a/zone_a_wall.geojson",
          renderer: {
            type: "simple",
            symbol: {
              type: "polygon-3d",
              symbolLayers: [
                {
                  type: "extrude",
                  size: 100.0,
                  material: {
                    color: "blue",
                  },
                },
              ],
            },
          },
        });

        // Zone B
        let listCircle = [];
        listCoordinates = [
          [-2.1989105634447634, 53.483150672141186],
          [-2.1989122188803583, 53.48305464617142],
          [-2.1989207507255952, 53.48298868489513],
          [-2.198937298374548, 53.48291663449119],
          [-2.198962093850303, 53.48284399417016],
          [-2.198997676338993, 53.48276871716416],
          [-2.199026224679031, 53.48268622834205],
          [-2.199105707169946, 53.482600174869525],
        ];
        for (let i = 0; i < 8; i++) {
          listCircle[i] = new Circle({
            center: listCoordinates[i],
            geodesic: true,
            numberOfPoints: 100,
            radius: 0.3,
            radiusUnit: "meters",
          });
        }
        const geojsonLayer_B_roof = new GeoJSONLayer({
          url: "./data/zone_b/zone_b_roof.geojson",
          renderer: {
            type: "simple",
            symbol: {
              type: "polygon-3d",
              symbolLayers: [
                {
                  type: "extrude",
                  size: 100.0,
                  material: {
                    color: "blue",
                  },
                },
              ],
            },
          },
        });
        const geojsonLayer_B_wall = new GeoJSONLayer({
          url: "./data/zone_b/zone_b_wall.geojson",
          renderer: {
            type: "simple",
            symbol: {
              type: "polygon-3d",
              symbolLayers: [
                {
                  type: "extrude",
                  size: 100.0,
                  material: {
                    color: "blue",
                  },
                },
              ],
            },
          },
        });
        const geojsonLayer_B_wall_1 = new GeoJSONLayer({
          url: "./data/zone_b/wall/wall_1.geojson",
        });
        const geojsonLayer_B_wall_3_1 = new GeoJSONLayer({
          url: "./data/zone_b/wall/wall_3_1.geojson",
        });
        const geojsonLayer_B_wall_3_2 = new GeoJSONLayer({
          url: "./data/zone_b/wall/wall_3_2.geojson",
        });
        const geojsonLayer_B_wall_3_3 = new GeoJSONLayer({
          url: "./data/zone_b/wall/wall_3_3.geojson",
        });
        const geojsonLayer_B_vline_wall_3_1 = new GeoJSONLayer({
          url: "./data/zone_b/wall/vertical_line_wall_3_1.geojson",
        });
        const geojsonLayer_B_round_pillar_1 = new GeoJSONLayer({
          url: "./data/zone_b/round_pillar/round_pillar_1.geojson",
        });
        const geojsonLayer_B_round_pillar_2 = new GeoJSONLayer({
          url: "./data/zone_b/round_pillar/round_pillar_2.geojson",
        });
        const geojsonLayer_B_round_pillar_3 = new GeoJSONLayer({
          url: "./data/zone_b/round_pillar/round_pillar_3.geojson",
        });
        const geojsonLayer_B_round_pillar_4 = new GeoJSONLayer({
          url: "./data/zone_b/round_pillar/round_pillar_4.geojson",
        });
        const geojsonLayer_B_round_pillar_5 = new GeoJSONLayer({
          url: "./data/zone_b/round_pillar/round_pillar_5.geojson",
        });
        const geojsonLayer_B_round_pillar_6 = new GeoJSONLayer({
          url: "./data/zone_b/round_pillar/round_pillar_6.geojson",
        });
        const geojsonLayer_B_round_pillar_7 = new GeoJSONLayer({
          url: "./data/zone_b/round_pillar/round_pillar_7.geojson",
        });
        const geojsonLayer_B_round_pillar_8 = new GeoJSONLayer({
          url: "./data/zone_b/round_pillar/round_pillar_8.geojson",
        });

        geojsonLayer_B_wall_1.renderer = {
          type: "simple",
          symbol: {
            type: "polygon-3d",
            symbolLayers: [
              {
                type: "extrude",
                size: 100.0,
                material: {
                  color: "#647a88",
                },
              },
            ],
          },
        };
        geojsonLayer_B_wall_3_1.renderer = {
          type: "simple",
          symbol: {
            type: "polygon-3d",
            symbolLayers: [
              {
                type: "extrude",
                size: 100.0,
                material: {
                  color: "#647a88",
                },
              },
            ],
          },
        };
        geojsonLayer_B_wall_3_2.renderer = {
          type: "simple",
          symbol: {
            type: "polygon-3d",
            symbolLayers: [
              {
                type: "extrude",
                size: 100.0,
                material: {
                  color: "#647a88",
                },
              },
            ],
          },
        };
        geojsonLayer_B_wall_3_3.renderer = {
          type: "simple",
          symbol: {
            type: "polygon-3d",
            symbolLayers: [
              {
                type: "extrude",
                size: 100.0,
                material: {
                  color: "#647a88",
                },
              },
            ],
          },
        };
        geojsonLayer_B_vline_wall_3_1.renderer = {
          type: "simple",
          symbol: {
            type: "polygon-3d",
            symbolLayers: [
              {
                type: "extrude",
                size: 100.0,
                material: {
                  color: "black",
                },
              },
            ],
          },
        };

        geojsonLayer_B_round_pillar_1.renderer = {
          type: "simple",
          symbol: {
            type: "polygon-3d",
            symbolLayers: [
              {
                type: "extrude",
                size: 100.0,
                material: {
                  color: "#4b4a46",
                },
              },
            ],
          },
        };
        geojsonLayer_B_round_pillar_2.renderer = {
          type: "simple",
          symbol: {
            type: "polygon-3d",
            symbolLayers: [
              {
                type: "extrude",
                size: 100.0,
                material: {
                  color: "#4b4a46",
                },
              },
            ],
          },
        };
        geojsonLayer_B_round_pillar_3.renderer = {
          type: "simple",
          symbol: {
            type: "polygon-3d",
            symbolLayers: [
              {
                type: "extrude",
                size: 100.0,
                material: {
                  color: "#4b4a46",
                },
              },
            ],
          },
        };
        geojsonLayer_B_round_pillar_4.renderer = {
          type: "simple",
          symbol: {
            type: "polygon-3d",
            symbolLayers: [
              {
                type: "extrude",
                size: 100.0,
                material: {
                  color: "#4b4a46",
                },
              },
            ],
          },
        };
        geojsonLayer_B_round_pillar_5.renderer = {
          type: "simple",
          symbol: {
            type: "polygon-3d",
            symbolLayers: [
              {
                type: "extrude",
                size: 100.0,
                material: {
                  color: "#4b4a46",
                },
              },
            ],
          },
        };
        geojsonLayer_B_round_pillar_6.renderer = {
          type: "simple",
          symbol: {
            type: "polygon-3d",
            symbolLayers: [
              {
                type: "extrude",
                size: 100.0,
                material: {
                  color: "#4b4a46",
                },
              },
            ],
          },
        };
        geojsonLayer_B_round_pillar_7.renderer = {
          type: "simple",
          symbol: {
            type: "polygon-3d",
            symbolLayers: [
              {
                type: "extrude",
                size: 100.0,
                material: {
                  color: "#4b4a46",
                },
              },
            ],
          },
        };
        geojsonLayer_B_round_pillar_8.renderer = {
          type: "simple",
          symbol: {
            type: "polygon-3d",
            symbolLayers: [
              {
                type: "extrude",
                size: 100.0,
                material: {
                  color: "#4b4a46",
                },
              },
            ],
          },
        };

        // Zone C
        const geojsonLayer_C_top = new GeoJSONLayer({
          url: "./data/zone_c/zone_c_top.geojson",
          renderer: {
            type: "simple",
            symbol: {
              type: "polygon-3d",
              symbolLayers: [
                {
                  type: "extrude",
                  size: 0.4,
                  material: {
                    color: "white",
                  },
                },
              ],
            },
          },
        });
        const geojsonLayer_C_wall = new GeoJSONLayer({
          url: "./data/zone_c/zone_c_wall.geojson",
          renderer: {
            type: "simple",
            symbol: {
              type: "polygon-3d",
              symbolLayers: [
                {
                  type: "extrude",
                  size: 101.0,
                  material: {
                    color: "#f0f0f0",
                  },
                },
              ],
            },
          },
        });
        const geojsonLayer_C_gate = new GeoJSONLayer({
          url: "./data/zone_c/zone_c_gate.geojson",
          renderer: {
            type: "simple",
            symbol: {
              type: "polygon-3d",
              symbolLayers: [
                {
                  type: "extrude",
                  size: 80.0,
                  material: {
                    color: "blue",
                  },
                },
              ],
            },
          },
        });
        const geojsonLayer_C_curve = new GeoJSONLayer({
          url: "./data/zone_c/zone_c_curve.geojson",
          renderer: {
            type: "simple",
            symbol: {
              type: "polygon-3d",
              symbolLayers: [
                {
                  type: "extrude",
                  size: 1.5,
                  material: {
                    color: "#c4c4c4",
                  },
                },
              ],
            },
          },
        });
        const geojsonLayer_C_roof_a = new GeoJSONLayer({
          url: "./data/zone_c/zone_c_roof_a.geojson",
          renderer: {
            type: "simple",
            symbol: {
              type: "polygon-3d",
              symbolLayers: [
                {
                  type: "extrude",
                  size: 0.2,
                  material: {
                    color: "#c4c4c4",
                  },
                },
              ],
            },
          },
        });
        const geojsonLayer_C_roof_b = new GeoJSONLayer({
          url: "./data/zone_c/zone_c_roof_b.geojson",
          renderer: {
            type: "simple",
            symbol: {
              type: "polygon-3d",
              symbolLayers: [
                {
                  type: "extrude",
                  size: 0.2,
                  material: {
                    color: "blue",
                  },
                },
              ],
            },
          },
        });

        // Zone D
        const geojsonLayer_D_roof = new GeoJSONLayer({
          url: "./data/zone_d/zone_d_roof.geojson",
          renderer: {
            type: "simple",
            symbol: {
              type: "polygon-3d",
              symbolLayers: [
                {
                  type: "extrude",
                  size: 100.0,
                  material: {
                    color: "blue",
                  },
                },
              ],
            },
          },
        });
        const geojsonLayer_D_wall = new GeoJSONLayer({
          url: "./data/zone_d/zone_d_wall.geojson",
          renderer: {
            type: "simple",
            symbol: {
              type: "polygon-3d",
              symbolLayers: [
                {
                  type: "extrude",
                  size: 100.0,
                  material: {
                    color: "blue",
                  },
                },
              ],
            },
          },
        });

        // Zone E
        const geojsonLayer_E_roof = new GeoJSONLayer({
          url: "./data/zone_e/zone_e_roof.geojson",
          renderer: {
            type: "simple",
            symbol: {
              type: "polygon-3d",
              symbolLayers: [
                {
                  type: "extrude",
                  size: 100.0,
                  material: {
                    color: "blue",
                  },
                },
              ],
            },
          },
        });
        const geojsonLayer_E_wall = new GeoJSONLayer({
          url: "./data/zone_e/zone_e_wall.geojson",
          renderer: {
            type: "simple",
            symbol: {
              type: "polygon-3d",
              symbolLayers: [
                {
                  type: "extrude",
                  size: 100.0,
                  material: {
                    color: "blue",
                  },
                },
              ],
            },
          },
        });

        

        // Spiral Stairs

        // Round Columns for Spiral Stairs
        const roundColumnLayerSpiral = new GraphicsLayer();
        const roundColumn_point_spiral = [
          [-2.199214597876507, 53.4838823487394, 50],
          [-2.1988804312003003, 53.483538189491995, 50],
          [-2.1987563679243802, 53.48310495815264, 50],
          [-2.1988623580722795, 53.48271284521822, 50],
          [-2.201882944520377, 53.48360738298203, 50],
          [-2.201993023811123, 53.48321004165876, 50],
          [-2.2018713186867824, 53.48277344024631, 50],
          [-2.201540077013828, 53.48243117205023, 50],
        ];
        const roundColumn_symbol_spiral = {
          type: "point-3d",
          symbolLayers: [
            {
              type: "object",
              width: 7,
              height: 100,
              resource: {
                primitive: "cylinder",
              },
              material: {
                color: "red",
              },
            },
          ],
        };
        for (const point of roundColumn_point_spiral) {
          const [x, y, z] = point;
          const pointLocation = new Point({
            x: x,
            y: y,
            z: z,
          });
          const roundColumn_pointGraphic = new Graphic({
            geometry: pointLocation,
            symbol: roundColumn_symbol_spiral,
          });
          roundColumnLayerSpiral.add(roundColumn_pointGraphic);
        }
        /* ----------End Round Columns for Spiral Stairs---------- */

        // Polygon banister Layer
        const polygon_banister_Layer = new GraphicsLayer();
        var polygon_banister = [
          {
            type: "polygon",
            rings: [
              [-2.1990145030118327, 53.48348685248627, 99.09999999999806],
              [-2.199026505948793, 53.48349359005887, 98.99999999999807],
              [-2.199036669927162, 53.48350913594487, 98.89999999999807],
              [-2.1990435781657482, 53.48351918950201, 98.79999999999808],
              [-2.1990462447161763, 53.48353190463802, 98.69999999999808],

              [-2.1990462447161763, 53.48353190463802, 100.69999999999808],
              [-2.1990435781657482, 53.48351918950201, 100.79999999999808],
              [-2.199036669927162, 53.48350913594487, 100.89999999999807],
              [-2.199026505948793, 53.48349359005887, 100.99999999999807],
              [-2.1990145030118327, 53.48348685248627, 99.09999999999806],
            ],
            symbol: {
              type: "extrude",
              color: "black",
              outline: {
                color: "black",
                width: 2
              }
            }
          }
        ]
        polygon_banister.forEach(function (data) {
          polygon_banister_Layer.add(createGraphic(data));
        });
        /* ---------- End Polygon banister Layer ---------- */
        const map = new Map({
          basemap: "topo-vector",
          ground: "world-elevation",
          layers: [
            // spiral_stair_floor,
            // spiral_stair_handles,
            geojsonLayer_A_roof,
            geojsonLayer_A_wall,
            geojsonLayer_B_roof,
            geojsonLayer_B_wall,
            geojsonLayer_B_wall_1,
            geojsonLayer_B_wall_3_1,
            geojsonLayer_B_wall_3_2,
            geojsonLayer_B_wall_3_3,
            geojsonLayer_B_vline_wall_3_1,
            geojsonLayer_B_round_pillar_1,
            geojsonLayer_B_round_pillar_2,
            geojsonLayer_B_round_pillar_3,
            geojsonLayer_B_round_pillar_4,
            geojsonLayer_B_round_pillar_5,
            geojsonLayer_B_round_pillar_6,
            geojsonLayer_B_round_pillar_7,
            geojsonLayer_B_round_pillar_8,
            geojsonLayer_C_top,
            geojsonLayer_C_wall,
            geojsonLayer_C_curve,
            geojsonLayer_C_roof_a,
            geojsonLayer_C_roof_b,
            geojsonLayer_C_gate,
            geojsonLayer_D_roof,
            geojsonLayer_D_wall,
            geojsonLayer_E_roof,
            geojsonLayer_E_wall,
          ],
        });
        // map.addMany([roundColumnLayerSpiral, polygon_banister_Layer]);

        const view = new SceneView({
          container: "viewDiv",
          map: map,
          camera: {
            position: [-2.1957615021032595, 53.4836002000014, 300],
            heading: 260,
            tilt: 50,
          },
        });

        for (let i = 0; i < 8; i++) {
          view.graphics.add(
            new Graphic({
              geometry: listCircle[i],
              symbol: {
                type: "simple-fill",
                style: "none",
                outline: {
                  width: 3,
                  color: "red",
                },
              },
            })
          );
        }

        view.popup.defaultPopupTemplateEnabled = true;
        // view.popup.autoOpenEnabled = false;
        view.on("click", function (event) {
          // Listen for the click event
          view.hitTest(event).then(function (hitTestResults) {
            if (hitTestResults.results) {
              list_points.push([
                event.mapPoint.longitude,
                event.mapPoint.latitude,
              ]);
              string_points +=
                "[" +
                event.mapPoint.longitude +
                ", " +
                event.mapPoint.latitude +
                "],";
              copyTextToClipboard(string_points);
            }
          });
        });
        /* ============================================================ */

        /* Spiral Stair */
        const locations = [
          { x: -2.199214597876507, y: 53.4838823487394, z: 42 },
          // { x: -2.198889337447818, y: 53.483537990433575, z: 42},
          // { x: -2.198753326311802, y: 53.4831040771985, z: 42},
          // { x: -2.1988669791679825, y: 53.482715645543365, z: 42},
          // { x: -2.2018982099127284, y: 53.48360418053181, z: 42},
          // { x: -2.20200827278425, y: 53.483208960860466, z: 42},
          // { x: -2.2018859292270636, y: 53.48277537857368, z: 42},
          // { x: -2.2015557232799385, y: 53.48242702862161, z: 42},
        ];
        locations.forEach(location => {
          const locationPoint = new Point(location);

          Mesh.createFromGLTF(locationPoint, "./model/Part1.gltf")
            .then(function (geometry) {
              geometry.scale(1000, {
                origin: {
                  locationPoint
                }
              });
              geometry.rotate(0, 0, 90);
              const graphic = new Graphic({
                geometry,
                symbol: {
                  type: "mesh-3d",
                  symbolLayers: [
                    {
                      type: "fill",
                      material: {
                        // color: "rgba(0, 0, 255, 0.5)"
                      },
                      size: 1000
                    }
                  ]
                }
              });
              view.graphics.add(graphic);
            })
            .catch(console.error);
        });
      });
      /* ============================================================ */
    </script>
  </head>

  <body>
    <div id="viewDiv"></div>
  </body>
</html>
